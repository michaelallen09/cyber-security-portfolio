# 1. Architecture

This section provides an overview of the virtual environment created to support the MITC attack simulation.  
The goal was to build an isolated, fully controlled cloud environment where identity management, cloud storage, and client behaviour could be manipulated and observed.

---

## 1.1 Overview of the Virtual Environment

The environment consisted of the following components:

- **Proxmox VE** – hosting all virtual machines used during testing  
- **Zentyal Server** – providing Microsoft-compatible directory services and identity management  
- **Nextcloud Server** – acting as the cloud storage platform vulnerable to token-based attack techniques  
- **Windows 10 Client** – configured with the Nextcloud desktop sync client  
- **Kali Linux** – attacker platform used for scanning, exploitation, and token acquisition  

These components replicated a small enterprise-style cloud deployment, enabling full attack simulation and defensive evaluation.

---

## 1.2 Purpose of Each Component

- **Proxmox:** Provided flexible VM management and network segmentation. This allowed the environment to be reset, cloned, or isolated for repeatable testing.  
- **Zentyal IAM:** Delivered user authentication, group policy-like controls, and compatible directory services required to test IAM weaknesses.  
- **Nextcloud:** Offered a cloud-based file sync solution using token authentication, which is central to MITC-style attacks.  
- **Windows Client:** Used as the victim machine to generate authentication tokens and demonstrate how Nextcloud stores credentials locally.  
- **Kali Attacker:** Carried out scanning, enumeration, SMB abuse, credential extraction, and token interception.

---

## 1.3 Network Design

A simplified internal network was implemented:

- One internal subnet for all virtual machines  
- Static addressing where required  
- Firewall restrictions applied within Proxmox  
- Communication allowed only between services essential for identity, file sync, and attack testing  

This controlled layout reduced noise, made enumeration clearer, and ensured only relevant services were exposed.

---

## 1.4 Architecture Diagram

<img width="1280" height="720" alt="Network Addressing Scheme" src="https://github.com/user-attachments/assets/8f055845-1cf0-4d1b-9903-f30cc85eef2c" />

---

## 1.5 Rationale Behind the Design

This architecture was chosen because it:

- Enabled a realistic simulation of a cloud storage workflow  
- Allowed control over both IAM and cloud layers  
- Provided visibility of token behaviour on the client  
- Supported the replication of MITC attack phases  
- Made it possible to measure the impact of defensive changes  

It intentionally mirrored elements of small-business cloud setups, where misconfigurations and token abuse are common.

---

## 1.6 Limitations

- VirtualBox was used initially but caused networking issues  
- Proxmox provided better isolation but required more configuration  
- Resource constraints limited the number of additional services (e.g., extra monitoring tools)

---

This architecture provided the foundation for the entire MITC simulation and enabled the penetration testing and mitigation stages that follow.
